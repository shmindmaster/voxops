# Environment Configuration Template
# Copy this file to .env and replace with your actual values
# Or, allow `azd up` to generate one for you as part of the postprovisioning automation
# =================================================================

# ============================================================================
# Azure Identity & Tenant Configuration (Required)
# ============================================================================
AZURE_TENANT_ID=12345678-1234-1234-1234-123456789abc                    # Required: Azure Active Directory tenant ID
AZURE_CLIENT_ID=your-azure-client-id                                     # Optional: Azure client ID for service principal auth
BACKEND_AUTH_CLIENT_ID=your-backend-auth-client-id                       # Required: Backend authentication client ID

# ============================================================================
# Application Insights & Monitoring (Required for Production)
# ============================================================================
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=12345678-1234-1234-1234-123456789abc;IngestionEndpoint=https://region.in.applicationinsights.azure.com/;LiveEndpoint=https://region.livediagnostics.monitor.azure.com/;ApplicationId=12345678-1234-1234-1234-123456789abc  # Required: Azure Application Insights connection string for telemetry
AZURE_MONITOR_DISABLE_LIVE_METRICS=false                                 # Optional: Disable live metrics collection (default: false)

# ============================================================================
# Pool Configuration for High Performance & Scale (Optimized for Production)
# ============================================================================
# Azure OpenAI Client Pool (Production Optimized)
AOAI_POOL_ENABLED=true                                                   # Optional: Enable AOAI client pool for concurrency (default: true)
AOAI_POOL_SIZE=50                                                        # Optional: Number of AOAI client instances (default: 10, production: 50+)
AOAI_USE_SESSION_POOL=true                                               # Optional: Use session-specific client allocation (default: true)
AOAI_POOL_DEBUG=false                                                    # Optional: Enable detailed pool performance logging (default: false)

# TTS Client Pool (Optimized for 100+ Concurrent Sessions)
POOL_SIZE_TTS=100                                                        # Optional: TTS client pool size (default: 50, production: 100+)
TTS_POOL_PREWARMING_ENABLED=true                                         # Optional: Enable TTS pool prewarming (default: true)

# STT Client Pool (Coordinated with TTS Pool)
POOL_SIZE_STT=100                                                        # Optional: STT client pool size (default: 50, production: 100+)
STT_POOL_PREWARMING_ENABLED=true                                         # Optional: Enable STT pool prewarming (default: true)

# Pool Performance Tuning
POOL_PREWARMING_BATCH_SIZE=10                                            # Optional: Batch size for pool prewarming (default: 10)
CLIENT_MAX_AGE_SECONDS=3600                                              # Optional: Maximum age for pooled clients in seconds (default: 3600)
CLEANUP_INTERVAL_SECONDS=180                                             # Optional: Cleanup interval for expired clients (default: 180)

# ============================================================================
# Azure OpenAI Configuration (Required)
# ============================================================================
AZURE_OPENAI_KEY=your-azure-openai-api-key                               # Required: Azure OpenAI API key
AZURE_OPENAI_ENDPOINT=https://your-openai-resource.openai.azure.com/     # Required: Azure OpenAI service endpoint
AZURE_OPENAI_DEPLOYMENT=o3-mini                                          # Optional: Default deployment name (default: varies by model)
AZURE_OPENAI_API_VERSION=2024-12-01-preview                              # Optional: API version (default: latest stable)
AZURE_OPENAI_CHAT_DEPLOYMENT_ID=gpt-4o                                   # Required: Chat completion deployment ID
AZURE_OPENAI_CHAT_DEPLOYMENT_VERSION=2024-10-01-preview                  # Optional: Chat deployment version

# ============================================================================
# Azure Speech Services Configuration (Required)
# ============================================================================
# For transcription, require a speech endpoint with a custom domain (not the generic regional endpoint)
AZURE_SPEECH_ENDPOINT=https://your-speech-resource.cognitiveservices.azure.com/  # Required: Custom domain Speech endpoint
AZURE_SPEECH_KEY=your-azure-speech-service-key                           # Required: Speech service API key
AZURE_SPEECH_RESOURCE_ID=/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/your-resource-group/providers/Microsoft.CognitiveServices/accounts/your-speech-resource  # Required: Full resource ID for Speech service
AZURE_SPEECH_REGION=your-region                                          # Required: Azure region for Speech service

# Legacy Speech Service Fallback (Optional - for backward compatibility)
AZURE_OPENAI_STT_TTS_ENDPOINT=https://your-speech-resource.cognitiveservices.azure.com/  # Optional: Legacy STT/TTS endpoint
AZURE_OPENAI_STT_TTS_KEY=your-azure-speech-service-key                   # Optional: Legacy STT/TTS key

# ============================================================================
# Azure Voice Live Integration (Optional - for Azure Voice Live API)
# ============================================================================
AZURE_VOICE_LIVE_ENDPOINT=https://your-voice-live-endpoint.voice.azure.com/  # Optional: Azure Voice Live API endpoint
AZURE_VOICE_LIVE_API_KEY=your-voice-live-api-key                         # Optional: Alternative API key name
AZURE_VOICE_LIVE_MODEL=gpt-4o                                            # Optional: Voice Live model deployment (default: gpt-4o)
AZURE_VOICE_LIVE_API_VERSION=2024-10-01-preview                          # Optional: Voice Live API version

# Azure AI Foundry Integration (Optional)
AZURE_AI_FOUNDRY_ENDPOINT=https://your-foundry-endpoint.services.ai.azure.com/api/projects/your-project  # Optional: AI Foundry project endpoint
AI_FOUNDRY_PROJECT_NAME=your-ai-foundry-project                          # Optional: AI Foundry project name
AI_FOUNDRY_AGENT_ID=your-ai-foundry-agent-id                            # Optional: AI Foundry agent ID
# ============================================================================
# Base URL Configuration (Required for Webhooks)
# ============================================================================
# Your Dev Tunnel base URL or public endpoint
BASE_URL=https://your-tunnel-url.devtunnels.ms                           # Required: Public base URL for webhooks and callbacks

# ============================================================================
# TTS Configuration (Optional)
# ============================================================================
TTS_ENABLE_LOCAL_PLAYBACK=false                                          # Optional: Enable local audio playback for testing (default: false)

# ============================================================================
# Azure Communication Services (ACS) Configuration (Required for Telephony)
# ============================================================================
ACS_CONNECTION_STRING=endpoint=https://your-acs-resource.communication.azure.com/;accesskey=your-acs-access-key  # Required: ACS connection string
ACS_SOURCE_PHONE_NUMBER=+1234567890                                      # Required: Source phone number for outbound calls
ACS_ENDPOINT=https://your-acs-resource.communication.azure.com           # Required: ACS endpoint URL
ACS_AUDIENCE=your-acs-immutable-resource-id                              # Optional: ACS Immutable Resource ID for JWT validation
ACS_STREAMING_MODE=media                                                  # Optional: Streaming mode (media/voice_live) (default: media)

# ============================================================================
# Redis Configuration (Required for Session Management)
# ============================================================================
REDIS_HOST=your-redis-host.redis.azure.net                              # Required: Redis hostname
REDIS_PORT=6380                                                          # Optional: Redis port (default: 6380 for Azure Redis with SSL)
REDIS_PASSWORD=your-redis-password                                       # Required: Redis password

# ============================================================================
# Azure Storage Configuration (Required for Recording Storage)
# ============================================================================
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=yourstorageaccount;AccountKey=your-storage-key;EndpointSuffix=core.windows.net  # Required: Storage account connection string
AZURE_STORAGE_CONTAINER_URL=https://yourstorageaccount.blob.core.windows.net/your-container  # Required: Blob container URL for recordings
AZURE_STORAGE_ACCOUNT_NAME=yourstorageaccount                            # Optional: Storage account name

# ============================================================================
# Azure Cosmos DB Configuration (Required for Data Persistence)
# ============================================================================
AZURE_COSMOS_DATABASE_NAME=your-database-name                            # Required: Cosmos DB database name
AZURE_COSMOS_COLLECTION_NAME=your-collection-name                        # Required: Cosmos DB collection name
AZURE_COSMOS_CONNECTION_STRING=mongodb+srv://your-cosmos-account.mongocluster.cosmos.azure.com/?tls=true&authMechanism=MONGODB-OIDC&retrywrites=false&maxIdleTimeMS=120000  # Required: Cosmos DB MongoDB connection string

# ============================================================================
# Azure Resource Configuration (Required for Deployment)
# ============================================================================
AZURE_SUBSCRIPTION_ID=12345678-1234-1234-1234-123456789abc               # Required: Azure subscription ID
AZURE_RESOURCE_GROUP=your-resource-group                                 # Required: Azure resource group name
AZURE_LOCATION=your-region                                               # Required: Azure region/location

# ============================================================================
# Application Configuration (Required)
# ============================================================================
ENVIRONMENT=development                                                   # Required: Environment type (development/staging/production)
LOG_LEVEL=INFO                                                           # Optional: Logging level (DEBUG/INFO/WARNING/ERROR) (default: INFO)

# ============================================================================
# Feature Flags & Validation (Optional)
# ============================================================================
DTMF_VALIDATION_ENABLED=false                                            # Optional: Enable DTMF validation (default: false)
ENABLE_AUTH_VALIDATION=false                                             # Optional: Enable authentication validation (default: false)
DEBUG=false                                                              # Optional: Enable debug mode (default: false)
ENABLE_DOCS=auto                                                         # Optional: Enable API documentation (auto/true/false) (default: auto)
ENABLE_PERFORMANCE_LOGGING=true                                          # Optional: Enable performance logging (default: true)
ENABLE_TRACING=true                                                      # Optional: Enable distributed tracing (default: true)

# ============================================================================
# Voice & Speech Configuration (Optional)
# ============================================================================
# Agent Configuration
AGENT_AUTH_CONFIG=apps/rtagent/backend/src/agents/artagent/agent_store/auth_agent.yaml  # Optional: Agent configuration file path

# TTS Voice Settings
GREETING_VOICE_TTS=en-US-AvaMultilingualNeural                           # Optional: Default TTS voice (extracted from agent config)
DEFAULT_VOICE_STYLE=neutral                                              # Optional: Default voice style (default: neutral)
DEFAULT_VOICE_RATE=0%                                                    # Optional: Default voice rate (default: 0%)

# TTS Audio Format
TTS_SAMPLE_RATE_UI=48000                                                 # Optional: TTS sample rate for UI (default: 48000)
TTS_SAMPLE_RATE_ACS=16000                                                # Optional: TTS sample rate for ACS (default: 16000)
TTS_CHUNK_SIZE=1024                                                      # Optional: TTS chunk size (default: 1024)
TTS_PROCESSING_TIMEOUT=8.0                                               # Optional: TTS processing timeout in seconds (default: 8.0)

# STT Configuration
STT_PROCESSING_TIMEOUT=10.0                                              # Optional: STT processing timeout in seconds (default: 10.0)
RECOGNIZED_LANGUAGE=en-US,es-ES,fr-FR,ko-KR,it-IT,pt-PT,pt-BR            # Optional: Supported languages for recognition

# VAD (Voice Activity Detection) Settings
VAD_SEMANTIC_SEGMENTATION=false                                          # Optional: Enable semantic segmentation for VAD (default: false)
SILENCE_DURATION_MS=1300                                                 # Optional: Silence duration for VAD in milliseconds (default: 1300)
AUDIO_FORMAT=pcm                                                         # Optional: Audio format (default: pcm)

# ============================================================================
# Connection & Session Management (Optional)
# ============================================================================
# WebSocket Connection Limits
MAX_WEBSOCKET_CONNECTIONS=200                                            # Optional: Maximum WebSocket connections (default: 200)
CONNECTION_QUEUE_SIZE=50                                                 # Optional: Connection queue size (default: 50)
ENABLE_CONNECTION_LIMITS=true                                            # Optional: Enable connection limits (default: true)

# Connection Monitoring Thresholds
CONNECTION_WARNING_THRESHOLD=150                                         # Optional: Warning threshold for connections (default: 150)
CONNECTION_CRITICAL_THRESHOLD=180                                        # Optional: Critical threshold for connections (default: 180)

# Connection Timeout Settings
CONNECTION_TIMEOUT_SECONDS=300                                           # Optional: Connection timeout in seconds (default: 300)
HEARTBEAT_INTERVAL_SECONDS=30                                            # Optional: Heartbeat interval in seconds (default: 30)

# Session Management
SESSION_TTL_SECONDS=1800                                                 # Optional: Session TTL in seconds (default: 1800)
SESSION_CLEANUP_INTERVAL=300                                             # Optional: Session cleanup interval in seconds (default: 300)
MAX_CONCURRENT_SESSIONS=1000                                             # Optional: Maximum concurrent sessions (default: 1000)
ENABLE_SESSION_PERSISTENCE=true                                          # Optional: Enable session persistence (default: true)

# ============================================================================
# Performance & Monitoring Configuration (Optional)
# ============================================================================
# Metrics Collection
METRICS_COLLECTION_INTERVAL=60                                           # Optional: Metrics collection interval in seconds (default: 60)
POOL_METRICS_INTERVAL=30                                                 # Optional: Pool metrics interval in seconds (default: 30)

# ============================================================================
# Media Realtime Orchestrator Configuration (Optional - Advanced Performance Tuning)
# ============================================================================
# Audio Processing Limits (api/v1/handlers/acs_media_handler.py)
MAX_CONCURRENT_AUDIO_TASKS=50                                            # Optional: Max concurrent audio tasks (default: 50, reduced from 500 for better performance)
MAX_EMERGENCY_AUDIO_TASKS=100                                            # Optional: Emergency threshold for audio tasks (default: 100)
AUDIO_PROCESSING_TIMEOUT_MS=50                                           # Optional: Audio processing timeout per chunk in milliseconds (default: 50)
AUDIO_BUFFER_SIZE=20                                                     # Optional: Emergency buffer size (default: 20)
